<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Past Simple Homework</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    body { margin: 0; background: #0b1220; color: #e9eefc; }
    .topbar {
      position: sticky; top: 0; z-index: 10; background: #0b1220;
      border-bottom: 1px solid #223055;
    }
    .topbar-inner {
      max-width: 900px; margin: 0 auto; padding: 12px 24px;
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
    }
    .brand { font-weight: 600; }
    .menu-wrap { position: relative; }
    .menu-btn {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 12px; border-radius: 10px; border: 1px solid #2a3b66;
      background: #1a2b55; color: #e9eefc; cursor: pointer;
    }
    .menu {
      position: absolute; right: 0; top: calc(100% + 8px); min-width: 200px;
      background: #121b2f; border: 1px solid #223055; border-radius: 12px;
      padding: 6px; display: none; box-shadow: 0 12px 24px rgba(0,0,0,.25);
    }
    .menu.open { display: block; }
    .menu button {
      width: 100%; text-align: left; background: transparent; border: none;
      padding: 10px 12px; border-radius: 8px; color: #e9eefc; cursor: pointer;
    }
    .menu button:hover { background: rgba(255,255,255,.08); }
    .wrap { max-width: 900px; margin: 0 auto; padding: 24px; }
    .section { display: none; }
    .section.active { display: block; }
    .card { background: #121b2f; border: 1px solid #223055; border-radius: 14px; padding: 16px; margin: 12px 0; }
    .panel {
      display: none; border: 1px solid #223055; border-radius: 16px; padding: 16px;
      background: #0f182b;
    }
    .panel.open { display: block; }
    .panel-header {
      display: flex; align-items: center; justify-content: space-between; gap: 12px;
      margin-bottom: 12px;
    }
    .panel-header h2 { margin: 0; font-size: 22px; }
    .panel-close {
      border-radius: 10px; border: 1px solid #2a3b66; background: #1a2b55; color: #e9eefc;
      padding: 6px 10px; cursor: pointer;
    }
    .welcome-card { text-align: center; font-size: 20px; font-weight: 600; }
    .tabs { display: flex; flex-wrap: wrap; gap: 8px; margin: 4px 0 10px; }
    .tab-btn {
      padding: 8px 12px; border-radius: 10px; border: 1px solid #2a3b66;
      background: #141f3f; color: #e9eefc; cursor: pointer;
    }
    .tab-btn.active { background: #233a6c; border-color: #3a538d; }
    h1 { margin: 0 0 6px; font-size: 26px; }
    .sub { opacity: .9; margin: 0 0 10px; }
    .meta { opacity: .7; font-size: 14px; margin-top: 6px; }
    label { display: block; margin-bottom: 8px; }
    input[type="text"]{
      width: 100%; padding: 10px 12px; border-radius: 10px;
      border: 1px solid #2a3b66; background: #0c1427; color: #e9eefc;
      outline: none;
    }
    .opts { display: grid; gap: 8px; }
    .opt {
      display: flex; gap: 10px; align-items: flex-start;
      border: 1px solid #2a3b66; border-radius: 10px; padding: 10px 12px; background: #0c1427;
      cursor: pointer;
    }
    .opt input { margin-top: 3px; }
    .btnbar { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; }
    button {
      padding: 10px 14px; border-radius: 10px; border: 1px solid #2a3b66;
      background: #1a2b55; color: #e9eefc; cursor: pointer;
    }
    button:hover { filter: brightness(1.08); }
    .result { margin-top: 10px; padding: 10px 12px; border-radius: 10px; border: 1px dashed #2a3b66; }
    .ok { border-color: #2e8b57; background: rgba(46,139,87,.12); }
    .bad { border-color: #c94b4b; background: rgba(201,75,75,.12); }
    .explain { margin-top: 8px; opacity: .95; line-height: 1.35; }
    .score { font-size: 18px; font-weight: 600; }
    .small { opacity: .8; font-size: 14px; }
    .footer { opacity: .75; font-size: 13px; margin-top: 18px; }
    .theory-block h3 { margin: 0 0 8px; }
    .theory-block ul { margin: 8px 0 0; padding-left: 18px; }
    code { background: rgba(255,255,255,.08); padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">English Tenses</div>
      <div class="menu-wrap">
        <button class="menu-btn" id="menuBtn" aria-haspopup="true" aria-expanded="false">‚ò∞ –ú–µ–Ω—é</button>
        <div class="menu" id="menu" role="menu">
          <button type="button" data-section="home">–ì–æ–ª–æ–≤–Ω–∞</button>
          <button type="button" data-section="theory">–¢–µ–æ—Ä—ñ—è</button>
          <button type="button" data-section="tasks">–ó–∞–≤–¥–∞–Ω–Ω—è</button>
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <section class="section active" id="homeSection">
      <div class="card welcome-card">–ü—Ä–∏–≤—ñ—Ç —Ü–µ –º—ñ–π —Å–∞–π—Ç –¥–ª—è —É—á–Ω—ñ–≤ üëã</div>
    </section>

    <section class="section" id="theorySection">
      <div class="panel open" id="theoryPanel">
        <div class="panel-header">
          <h2>–¢–µ–æ—Ä—ñ—è</h2>
          <button class="panel-close" type="button" data-close="theoryPanel">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
        <div id="theoryContent"></div>
      </div>
    </section>

    <section class="section" id="tasksSection">
      <div class="panel" id="tasksPanel">
        <div class="panel-header">
          <h2>–ó–∞–≤–¥–∞–Ω–Ω—è</h2>
          <button class="panel-close" type="button" data-close="tasksPanel">–ó–∞–∫—Ä–∏—Ç–∏</button>
        </div>
        <div class="tabs" role="tablist">
          <button class="tab-btn" type="button" data-taskset="present">Present Simple</button>
          <button class="tab-btn" type="button" data-taskset="past">Past Simple</button>
          <button class="tab-btn" type="button" data-taskset="future">Future Simple</button>
        </div>
        <div class="card">
          <h1 id="title">Homework</h1>
          <p class="sub" id="subtitle"></p>
          <div class="meta" id="meta"></div>

          <div class="btnbar">
            <button id="checkBtn">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏</button>
            <button id="resetBtn" title="–û—á–∏—Å—Ç–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ">–°–∫–∏–Ω—É—Ç–∏</button>
            <button id="copyBtn" title="–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç">–°–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
          </div>

          <div class="result" id="overall" style="display:none;"></div>
          <div class="footer" id="footerHint"></div>
        </div>

        <div id="tasks"></div>
      </div>
    </section>
  </div>

  <script src="tasks.js"></script>
  <script>
    // ---- Helpers ----
    const $ = (sel) => document.querySelector(sel);

    const sectionEls = {
      home: $("#homeSection"),
      theory: $("#theorySection"),
      tasks: $("#tasksSection")
    };
    const menuBtn = $("#menuBtn");
    const menu = $("#menu");
    const theoryPanel = $("#theoryPanel");
    const tasksPanel = $("#tasksPanel");
    const tabButtons = Array.from(document.querySelectorAll(".tab-btn"));
    let activeTaskSet = "present";

    function normalizeAnswer(s, mode) {
      if (typeof s !== "string") return "";
      let out = s.trim();
      // –±–∞–∑–æ–≤–∞ –Ω–æ—Ä–º–∞–ª—ñ–∑–∞—Ü—ñ—è
      out = out.replace(/\s+/g, " ");
      if (mode === "lower") out = out.toLowerCase();
      if (mode === "space") out = out.replace(/\s+/g, " ").trim();
      if (mode === "lower+space") out = out.toLowerCase().replace(/\s+/g, " ").trim();
      return out;
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;");
    }

    function getTheoryValue(key, fallback) {
      const theory = window.HW?.theory || {};
      const tense = activeTaskSet;
      if (tense && theory[tense] && theory[tense][key]) return theory[tense][key];
      if (theory[key]) return theory[key];
      return fallback;
    }

    function pickFeedback(task, userRaw) {
      const user = normalizeAnswer(userRaw, "lower+space");
      const fb = task.feedback || {};
      if (fb[user]) return fb[user];
      // —ñ–Ω–∫–æ–ª–∏ —É—á–Ω—ñ –≤–≤–æ–¥—è—Ç—å –∑–∞–π–≤—ñ –∫—Ä–∞–ø–∫–∏/–∫–æ–º–∏
      const cleaned = user.replace(/[.?!,;:]+$/g, "");
      if (fb[cleaned]) return fb[cleaned];
      if (fb["*"]) return fb["*"];
      return getTheoryValue("wrongAnswer", "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä –ø—Ä–∞–≤–∏–ª–æ –π —Å–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑.");
    }

    function isAccepted(task, userRaw) {
      const normMode = task.normalize ? (task.normalize === "space" ? "lower+space" : "lower+space") : "lower+space";
      const user = normalizeAnswer(userRaw, normMode);

      if (task.type === "fill") {
        const accept = (task.accept || []).map(a => normalizeAnswer(a, normMode));
        return accept.includes(user);
      }
      if (task.type === "mcq") {
        return Number(userRaw) === task.correctIndex;
      }
      return false;
    }

    function renderHeader() {
      $("#title").textContent = window.HW?.title || "Homework";
      $("#subtitle").textContent = window.HW?.subtitle || "";
      $("#meta").textContent = window.HW?.version ? `–í–µ—Ä—Å—ñ—è: ${window.HW.version}` : "";
      const footer = $("#footerHint");
      if (footer) {
        footer.innerHTML = getTheoryValue(
          "footerHint",
          "–ü–æ—Ä–∞–¥–∞: –∑–≤–µ—Ä—Ç–∞–π —É–≤–∞–≥—É –Ω–∞ —á–∞—Å–æ–≤—ñ –º–∞—Ä–∫–µ—Ä–∏ –≤ —Ä–µ—á–µ–Ω–Ω—ñ —Ç–∞ —Ñ–æ—Ä–º—É –¥—ñ—î—Å–ª–æ–≤–∞."
        );
      }
    }

    function renderTasks() {
      const container = $("#tasks");
      container.innerHTML = "";
      const tasks = getActiveTasks();

      tasks.forEach((task) => {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.taskId = task.id;

        const prompt = document.createElement("div");
        prompt.innerHTML = `<div style="font-weight:600; margin-bottom:8px;">${escapeHtml(task.prompt)}</div>`;
        card.appendChild(prompt);

        if (task.type === "fill") {
          const label = document.createElement("label");
          label.innerHTML = `–í—ñ–¥–ø–æ–≤—ñ–¥—å:`;
          const input = document.createElement("input");
          input.type = "text";
          input.placeholder = "–ù–∞–ø–∏—à–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —Ç—É—Ç...";
          input.autocomplete = "off";
          input.dataset.kind = "answer";
          input.dataset.taskId = task.id;
          label.appendChild(input);
          card.appendChild(label);

        } else if (task.type === "mcq") {
          const opts = document.createElement("div");
          opts.className = "opts";

          task.options.forEach((opt, i) => {
            const row = document.createElement("label");
            row.className = "opt";
            row.innerHTML = `
              <input type="radio" name="${task.id}" value="${i}" />
              <div>${escapeHtml(opt)}</div>
            `;
            opts.appendChild(row);
          });

          card.appendChild(opts);
        }

        const result = document.createElement("div");
        result.className = "result";
        result.style.display = "none";
        result.dataset.kind = "result";
        card.appendChild(result);

        container.appendChild(card);
      });
    }

    function renderTheory() {
      const container = $("#theoryContent");
      container.innerHTML = "";
      const theory = window.HW?.theory || {};
      const order = [
        { key: "present", label: "Present Simple" },
        { key: "past", label: "Past Simple" },
        { key: "future", label: "Future Simple" }
      ];

      order.forEach(({ key, label }) => {
        const data = theory[key];
        if (!data) return;
        const block = document.createElement("div");
        block.className = "card theory-block";

        const title = document.createElement("h3");
        title.textContent = data.title || label;
        block.appendChild(title);

        if (Array.isArray(data.rules)) {
          const list = document.createElement("ul");
          data.rules.forEach(rule => {
            const li = document.createElement("li");
            li.textContent = rule;
            list.appendChild(li);
          });
          block.appendChild(list);
        }

        if (Array.isArray(data.examples)) {
          const exampleList = document.createElement("ul");
          data.examples.forEach(example => {
            const li = document.createElement("li");
            li.textContent = `${example.en} ‚Äî ${example.uk}`;
            exampleList.appendChild(li);
          });
          block.appendChild(exampleList);
        }

        container.appendChild(block);
      });
    }

    function getUserAnswer(task) {
      if (task.type === "fill") {
        const input = document.querySelector(`input[data-kind="answer"][data-task-id="${task.id}"]`);
        return input ? input.value : "";
      }
      if (task.type === "mcq") {
        const checked = document.querySelector(`input[type="radio"][name="${task.id}"]:checked`);
        return checked ? Number(checked.value) : null;
      }
      return "";
    }

    function getActiveTasks() {
      return window.HW?.taskSets?.[activeTaskSet] || [];
    }

    // ---- Check ----
    function checkAll() {
      const tasks = getActiveTasks();
      if (!tasks.length) return;
      let correct = 0;

      tasks.forEach(task => {
        const ans = getUserAnswer(task);
        const ok = isAccepted(task, ans);

        const card = document.querySelector(`.card[data-task-id="${task.id}"]`);
        const box = card.querySelector(`div[data-kind="result"]`);

        box.style.display = "block";
        box.classList.remove("ok", "bad");

        if (ok) {
          correct++;
          box.classList.add("ok");
          box.innerHTML = `‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!`;
        } else {
          box.classList.add("bad");

          let explain = "";
          if (task.type === "fill") {
            explain = pickFeedback(task, ans);
          } else if (task.type === "mcq") {
            if (ans === null) {
              explain = "–¢–∏ –Ω—ñ—á–æ–≥–æ –Ω–µ –æ–±—Ä–∞–≤(–ª–∞). –û–±–µ—Ä–∏ –≤–∞—Ä—ñ–∞–Ω—Ç —ñ –ø–µ—Ä–µ–≤—ñ—Ä —â–µ —Ä–∞–∑.";
            } else {
              explain = (task.explanations && task.explanations[ans]) ||
                        getTheoryValue("wrongAnswer", "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä –ø—Ä–∞–≤–∏–ª–æ –π —Å–ø—Ä–æ–±—É–π —â–µ —Ä–∞–∑.");
            }
          }

          box.innerHTML = `‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.<div class="explain">${explain}</div>`;
        }
      });

      const overall = $("#overall");
      overall.style.display = "block";
      overall.className = "result " + (correct === tasks.length ? "ok" : "bad");
      overall.innerHTML = `
        <div class="score">–†–µ–∑—É–ª—å—Ç–∞—Ç: ${correct} / ${tasks.length}</div>
        <div class="small">–ü–æ—Ä–∞–¥–∞: —è–∫—â–æ –±–∞—á–∏—à <b>did/didn't</b> ‚Äî –¥—ñ—î—Å–ª–æ–≤–æ –∑–∞–≤–∂–¥–∏ –≤ <b>V1</b> (–±–µ–∑ -ed).</div>
      `;
    }

    // ---- Reset ----
    function resetAll() {
      document.querySelectorAll(`input[type="text"][data-kind="answer"]`).forEach(i => i.value = "");
      document.querySelectorAll(`input[type="radio"]`).forEach(r => r.checked = false);
      document.querySelectorAll(`div[data-kind="result"]`).forEach(b => { b.style.display = "none"; b.classList.remove("ok","bad"); b.innerHTML = ""; });
      $("#overall").style.display = "none";
      $("#overall").innerHTML = "";
    }

    // ---- Copy results (for students to send teacher) ----
    async function copyResults() {
      const tasks = getActiveTasks();
      const lines = [];
      lines.push(`${window.HW?.title || "Homework"} | version ${window.HW?.version || ""}`);
      tasks.forEach(t => {
        const ans = getUserAnswer(t);
        let a = ans;
        if (t.type === "mcq") {
          a = (ans === null) ? "(no answer)" : `${ans}: ${t.options[ans]}`;
        }
        lines.push(`${t.id} ‚Äî ${t.prompt} => ${a}`);
      });
      const text = lines.join("\n");
      try {
        await navigator.clipboard.writeText(text);
        alert("–°–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ! –¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –≤—Å—Ç–∞–≤–∏—Ç–∏ –≤ —á–∞—Ç/–ø–æ—à—Ç—É –≤—á–∏—Ç–µ–ª—é üôÇ");
      } catch {
        alert("–ù–µ –≤–¥–∞–ª–æ—Å—å —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –°–ø—Ä–æ–±—É–π –≤—Ä—É—á–Ω—É (–±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ –±–ª–æ–∫—É–≤–∞—Ç–∏).");
      }
    }

    // ---- UI ----
    function closeMenu() {
      menu.classList.remove("open");
      menuBtn.setAttribute("aria-expanded", "false");
    }

    function toggleMenu() {
      const willOpen = !menu.classList.contains("open");
      menu.classList.toggle("open", willOpen);
      menuBtn.setAttribute("aria-expanded", String(willOpen));
    }

    function setSection(name) {
      Object.entries(sectionEls).forEach(([key, el]) => {
        el.classList.toggle("active", key === name);
      });
      if (name === "theory") {
        openPanel(theoryPanel);
      }
      if (name === "tasks") {
        openPanel(tasksPanel);
      }
    }

    function openPanel(panel) {
      panel.classList.add("open");
    }

    function closePanel(panel) {
      panel.classList.remove("open");
    }

    function setActiveTaskSet(nextSet) {
      activeTaskSet = nextSet;
      tabButtons.forEach(btn => {
        btn.classList.toggle("active", btn.dataset.taskset === activeTaskSet);
      });
      renderHeader();
      renderTasks();
      resetAll();
    }

    renderHeader();
    renderTheory();
    setActiveTaskSet(activeTaskSet);

    $("#checkBtn").addEventListener("click", checkAll);
    $("#resetBtn").addEventListener("click", resetAll);
    $("#copyBtn").addEventListener("click", copyResults);

    menuBtn.addEventListener("click", (event) => {
      event.stopPropagation();
      toggleMenu();
    });

    menu.querySelectorAll("button[data-section]").forEach(btn => {
      btn.addEventListener("click", () => {
        setSection(btn.dataset.section);
        closeMenu();
      });
    });

    tabButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        setActiveTaskSet(btn.dataset.taskset);
      });
    });

    document.querySelectorAll("[data-close]").forEach(btn => {
      btn.addEventListener("click", () => {
        const panel = document.getElementById(btn.dataset.close);
        if (panel) {
          closePanel(panel);
        }
      });
    });

    document.addEventListener("click", (event) => {
      if (!menu.contains(event.target) && event.target !== menuBtn) {
        closeMenu();
      }
    });
  </script>
</body>
</html>
<!-- redeploy -->
